\appendix
\label{sec:anhang}


\begin{landscape}
\section{Diagramme und Grafiken}
\label{sec:figures}

\subsection{Geschäftslogik}
    \begin{figure}[!htp]
       \centering
       \begin{minipage}{0.45\textwidth}
         \centering
         \caption{UML Diagramm der bisherigen Geschäftslogik}%
         \label{fig:businessLogicAlt}%
         \includegraphics[height=11cm, angle=0]{businessLogicOld}%
       \end{minipage}\hspace*{4ex}%
       \begin{minipage}{0.57\textwidth}
         \centering
         \caption{UML Diagramm der Geschäftslogik nach Fertigstellung des Projekts}%
         \label{fig:businessLogicNeu}%
         \includegraphics[height=11cm, angle=0]{businessLogicNew}%
       \end{minipage}
    \end{figure}

\end{landscape}


\begin{figure}[!htp]
	\caption{Programmlogik als UML Aktivitätsdiagramm}
	\label{fig:programmlogik}
	\includegraphics[width=\textwidth]{algo}
	\centering
\end{figure}

\begin{figure}[!htp]
    \caption{Verteilung der QGramme im zu bearbeitenden Datensatz}
    \label{fig:qgram_verteilung}
    \includegraphics[width=\textwidth]{multiplicity_of_qgrams.eps}
    \centering
\end{figure}

\begin{figure}[!htp]
    \caption{UML Darstellung des Datenmodells}
    \label{fig:datenmodell}
    \includegraphics[width=\textwidth]{datenmodell}
    \centering
\end{figure}

\clearpage
\begin{landscape}
\section{Tabellen}
\label{sec:tabellen}

\begin{table}[!htp]
	\centering
	\caption{Projektkosten}
	\label{tabelle:projektkosten}
	\begin{tabular}{llllll}
		\rowcolor[HTML]{9698ED}
		{\color[HTML]{FFFFFF} \textbf{Vorgang}} & {\color[HTML]{FFFFFF} \textbf{Mitarbeiter}} & {\color[HTML]{FFFFFF} \textbf{Stunden}} & {\color[HTML]{FFFFFF} \textbf{Personal}} & {\color[HTML]{FFFFFF} \textbf{Ressources}} & {\color[HTML]{FFFFFF} \textbf{Gesamt}} \\
		Entwicklungskosten                      & 1                                           & 70                                      & 385.00 \euro{}                                 & 1,295.00 \euro{}                                 & 1,680.00 \euro{}                             \\
		\rowcolor[HTML]{BBDAFF}
		Fachgespräch                            & 2                                           & 5                                       & 350.00 \euro{}                                 & 92.50 \euro{}                                    & 1,842.50 \euro{}                             \\
		Code Review                             & 2                                           & 2                                       & 140.00 \euro{}                                 & 37.00 \euro{}                                    & 317.00 \euro{}                               \\
		\rowcolor[HTML]{BBDAFF}
		Abnahme                                 & 2                                           & 0.5                                     & 35.00 \euro{}                                  & 9.25 \euro{}                                     & 44.25 \euro{}                                \\
		&                                             &                                         & \multicolumn{2}{l}{\textbf{Projektkosten Gesamt:}}                                    & \textbf{3,883.75 \euro{}}
	\end{tabular}
\end{table}

% Please add the following required packages to your document preamble:
% \usepackage{multirow}
% \usepackage[table,xcdraw]{xcolor}
% If you use beamer only pass "xcolor=table" option, i.e. \documentclass[xcolor=table]{beamer}
\begin{table}[!htp]
\centering
\caption{Nutzwertanalyse Projektentwicklung}
\label{nwa:projektentwicklung}
\begin{tabular}{lccccccccc}
\rowcolor[HTML]{9698ED}
\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} } & \cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} } & \multicolumn{2}{c}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Externe Entwicklung}}} & \multicolumn{2}{c}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Interne Entwicklung}}} & \multicolumn{2}{c}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Dedizierter 12-Kerner}}} & \multicolumn{2}{c}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Cluster}}} \\
\rowcolor[HTML]{9698ED}
\multirow{-2}{*}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Kriterien}}} & \multirow{-2}{*}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Gewicht}}} & {\color[HTML]{FFFFFF} \textbf{Bewertung}} & {\color[HTML]{FFFFFF} \textbf{Gesamt}} & {\color[HTML]{FFFFFF} \textbf{Bewertung}} & {\color[HTML]{FFFFFF} \textbf{Gesamt}} & {\color[HTML]{FFFFFF} \textbf{Bewertung}} & {\color[HTML]{FFFFFF} \textbf{Gesamt}} & {\color[HTML]{FFFFFF} \textbf{Bewertung}} & {\color[HTML]{FFFFFF} \textbf{Gesamt}} \\
Projektkosten & 45.00\% & 4 & 1.8 & 5 & 2.25 & 4 & 1.8 & 3 & 1.35 \\
\rowcolor[HTML]{9698ED}
Nachhaltigkeit & 15.00\% & 4 & 0.6 & 4 & 0.6 & 1 & 0.15 & 1 & 0.15 \\
Flexibilität & 5.00\% & 3 & 0.15 & 5 & 0.25 & 4 & 0.2 & 4 & 0.2 \\
\rowcolor[HTML]{BBDAFF}
Unterhaltskosten & 35.00\% & 4 & 1.4 & 4 & 1.4 & 2 & 0.7 & 1 & 0.35 \\
\rowcolor[HTML]{FFFFFF}
{\color[HTML]{000000} \textbf{Gesamt}} & {\color[HTML]{000000} \textbf{100.00\%}} & {\color[HTML]{000000} \textbf{}} & {\color[HTML]{000000} \textbf{3.95}} & {\color[HTML]{000000} \textbf{}} & {\color[HTML]{000000} \textbf{4.5}} & {\color[HTML]{000000} \textbf{}} & {\color[HTML]{000000} \textbf{2.85}} & {\color[HTML]{000000} \textbf{}} & {\color[HTML]{000000} \textbf{2.05}}
\end{tabular}
\end{table}
\end{landscape}

\clearpage
\begin{landscape}
\begin{table}[!htp]
\centering
\caption{Nutzwertanalyse der Programmiersprachen}
\label{nwa:sprachen}
\begin{tabular}{llllllllll}
\rowcolor[HTML]{9698ED}
\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} } & \cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} } & \multicolumn{2}{l}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{C}}} & \multicolumn{2}{l}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{C++}}} & \multicolumn{2}{l}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Java}}} & \multicolumn{2}{l}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Haskell}}} \\
\rowcolor[HTML]{9698ED}
\multirow{-2}{*}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Kriterien}}} & \multirow{-2}{*}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Gewicht}}} & {\color[HTML]{FFFFFF} \textbf{Bewertung}} & {\color[HTML]{FFFFFF} \textbf{Gesamt}} & {\color[HTML]{FFFFFF} \textbf{Bewertung}} & {\color[HTML]{FFFFFF} \textbf{Gesamt}} & {\color[HTML]{FFFFFF} \textbf{Bewertung}} & {\color[HTML]{FFFFFF} \textbf{Gesamt}} & {\color[HTML]{FFFFFF} \textbf{Bewertung}} & {\color[HTML]{FFFFFF} \textbf{Gesamt}} \\
Performanz & 30.00\% & 5 & 1.5 & 5 & 1.5 & 4 & 1.2 & 5 & 1.5 \\
\rowcolor[HTML]{BBDAFF}
Speichereffizienz & 30.00\% & 5 & 1.5 & 5 & 1.5 & 3 & 0.9 & 4 & 1.2 \\
Dokumentation & 20.00\% & 5 & 1 & 4 & 0.8 & 4 & 0.8 & 2 & 0.4 \\
\rowcolor[HTML]{BBDAFF}
\begin{tabular}[c]{@{}l@{}}Systemische \\ Vorraussetzungen\end{tabular} & 10.00\% & 5 & 0.5 & 5 & 0.5 & 3 & 0.3 & 3 & 0.3 \\
Datenstrukturen & 10.00\% & 3 & 0.3 & 4 & 0.4 & 5 & 0.5 & 5 & 0.5 \\
\rowcolor[HTML]{BBDAFF}
\textbf{Gesamt} & \textbf{100.00\%} & \textbf{} & \textbf{4.8} & \textbf{} & \textbf{4.7} & \textbf{} & \textbf{3.7} & \textbf{} & \textbf{3.9}
\end{tabular}
\end{table}

\begin{table}[!htp]
	\centering
	\caption{Nutzwertanalyse der Datentypen für Q}
	\label{nwa:datentyp}
	\begin{tabular}{llllll}
		\rowcolor[HTML]{9698ED}
		\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} }                                     & \cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} }                                   & \multicolumn{2}{l}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Hashmap}}} & \multicolumn{2}{l}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Binärbaum}}} \\
		\rowcolor[HTML]{9698ED}
		\multirow{-2}{*}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Kriterien}}} & \multirow{-2}{*}{\cellcolor[HTML]{9698ED}{\color[HTML]{FFFFFF} \textbf{Gewicht}}} & {\color[HTML]{FFFFFF} \textbf{Bewertung}}  & {\color[HTML]{FFFFFF} \textbf{Gesamt}} & {\color[HTML]{FFFFFF} \textbf{Bewertung}}   & {\color[HTML]{FFFFFF} \textbf{Gesamt}}  \\
		Speicheraufwand                                                                     & 25.00\%                                                                           & 2                                          & 0.5                                    & 2                                           & 0.5                                     \\
		\rowcolor[HTML]{BBDAFF}
		Schnelligkeit Daten Einfügen (Insert)                                                & 20.00\%                                                                           & 5                                          & 1                                      & 4                                           & 0.8                                     \\
		Schnelligkeit Auslesen (Look-up)                                                    & 55.00\%                                                                           & 5                                          & 2.75                                   & 4                                           & 2.2                                     \\
		\rowcolor[HTML]{BBDAFF}
		\textbf{Gesamt}                                                                     & \textbf{100.00\%}                                                                 & \textbf{}                                  & \textbf{4.25}                          & \textbf{}                                   & \textbf{3.5}
	\end{tabular}
\end{table}
\end{landscape}


\begin{table}[!htp]
\centering
\caption{Detaillierte Zeitplanung}
\label{table:zeitplanung}
\begin{tabular}{|lrrr|}
\hline
\rowcolor[HTML]{9698ED}
{\color[HTML]{FFFFFF} \textbf{Analysephase}}            & {\color[HTML]{FFFFFF} \textbf{}} & {\color[HTML]{FFFFFF} \textbf{}} & {\color[HTML]{FFFFFF} \textbf{9h}} \\ \hline
1. Analyse des Ist-Zustands                                        &                                  & 3h                               &                                               \\
\rowcolor[HTML]{BBDAFF}
1.1 Fachgespräch mit der Datenverarbetungsabteilung                & \textit{1h}                    &                                  &                                               \\
1.2 Prozessanalyse                                                 & \textit{2h}                    &                                  &                                               \\
\rowcolor[HTML]{BBDAFF}
2. "Make or Buy" Entscheidung und Wirtschaftlichkeitsanalyse       &                                  & 1h                               &                                               \\
3. Erstellen eines "Use-Case" Diagramms                            &                                  & 2h                               &                                               \\
\rowcolor[HTML]{BBDAFF}
4. Erstellen eines Lastenhefts mit der Abteilung Datenverarbeitung &                                  & 3h                               &                                               \\ \hline
\rowcolor[HTML]{9698ED}
{\color[HTML]{FFFFFF} \textbf{Entwurfsphase}}                    & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} \textbf{26h}}         \\ \hline
1. Prozessentwurf                                                  &                                  & 2h                               &                                               \\
\rowcolor[HTML]{BBDAFF}
2. Algorithmusentwurf                                              &                                  & 14h                              &                                               \\
3. Entwurf von C Datenstrukturen                                   &                                  & 5h                               &                                               \\
\rowcolor[HTML]{BBDAFF}
3.1 Speicherarme Q-Gramm Liste                                     & \textit{3h}                    &                                  &                                               \\
3.2 Selbst-ausgleichender Binär Baum                               & \textit{2h}                    &                                  &                                               \\
\rowcolor[HTML]{BBDAFF}
4. Entwurf der Kommandozeilenoberfläche                            &                                  & 2h                               &                                               \\
5. Erstellen eines UML Komponentendiagramms der Anwendung          &                                  & 4h                               &                                               \\
\rowcolor[HTML]{BBDAFF}
6. Erstellen des Pflichtenhefts                                    &                                  & 4h                               &                                               \\ \hline
\rowcolor[HTML]{9698ED}
{\color[HTML]{FFFFFF} \textbf{Implementierungsphase}}            & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} \textbf{21h}}         \\ \hline
1. Unittests erstellen                                             &                                  & 5h                               &                                               \\
\rowcolor[HTML]{BBDAFF}
2. C Datenstrukturen Implementieren                                &                                  & 8h                               &                                               \\
3. Algorithmus Logik in C Implementieren                           &                                  & 8h                               &                                               \\ \hline
\rowcolor[HTML]{9698ED}
{\color[HTML]{FFFFFF} \textbf{Abnahmephase}}                     & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} \textbf{2h}}          \\ \hline
1. Code-Flight mit Abteilungsleitung                               &                                  & 1h                               &                                               \\
\rowcolor[HTML]{BBDAFF}
2. Präsentation                                                    &                                  & 1h                               &                                               \\ \hline
\rowcolor[HTML]{9698ED}
{\color[HTML]{FFFFFF} \textbf{Dokumentationsphase}}              & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} \textbf{9h}}          \\ \hline
1. Erstellen der Nutzerdokumentation als Man Page                  &                                  & 2h                               &                                               \\
\rowcolor[HTML]{BBDAFF}
2. Erstellen der Projektdokumentation                              &                                  & 7h                               &                                               \\ \hline
\rowcolor[HTML]{9698ED}
{\color[HTML]{FFFFFF} \textbf{Pufferzeit}}                                  & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} 2h}                     \\ \hline
1. Puffer                                                          &                                  & 3h                               &                                               \\ \hline
\rowcolor[HTML]{9698ED}
{\color[HTML]{FFFFFF} \textbf{Gesamt}}                           & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} }          & {\color[HTML]{FFFFFF} \textbf{70h}}         \\ \hline
\end{tabular}
\end{table}


\clearpage
\section{Auszüge}
\label{sec:textAuszüge}
\subsection{Ressourcen}
\label{auszug:ressourcen}
\textbf{Hardware}
\begin{itemize}
    \item Büroarbeitsplatz mit vernetztem Rechner
    \item Laptop
\end{itemize}

\textbf{Software}
\begin{itemize}
    \item openSuSE 13.1 -- Linux Distribution
    \item Atom IDE -- Modulare, Open-Source Entwicklungsumgebung für eine Vielfalt an Sprachen
    \item \LaTeX -- Textsatzsystem zur Erstellung von Dokumenten
    \item GNU Compiler Collection (GCC) -- Compilersammlung des GNU Projekts
    \item Git -- Denzentrale Versionsverwaltung
\end{itemize}

\textbf{Personal}
\begin{itemize}
    \item Mitarbeiter der Abteilung Datenverarbeitung -- Festlegung der Anforderungen sowie Abnahme des Projektes
    \item Entwickler -- Umsetzung des Projekts
    \item Anwendungsentwickler -- Code Review
\end{itemize}


\subsection{Lastenheft}
\label{auszug:lastenheft}
\renewcommand{\labelenumii}{\theenumii}
\renewcommand{\theenumii}{\theenumi.\arabic{enumii}.}
\begin{enumerate}
	\item Spezifikationen des Algorithmus
	\begin{enumerate}
		\item Der Algorithmus muss 2 Listen von Strings verarbeiten können,
		wobei eine dieser Listen garantiert in den Speicher passt und die zweite
		eine beliebige Größe haben kann.
		\item Der Algorithmus muss aus der ersten Liste sämtliche Strings finden,
		welche den Strings aus der zweiten Liste ähneln. Die gefundenen Stringpaare
		sollen ausgegeben werden.
		\item Der Algorithmus ist in C zu programmieren.
		\item Der Algorithmus verarbeitet 7-Bit ASCII Strings schreibungsunabhängig. Zeichensetzung
		ist beim Vergleich generell zu ignorieren; Ausnahmen bilden die
		Zeichen Bindestrich, Unterstrich und Leerzeichen.
	\end{enumerate}
	\item Spezifikationen des Kommandozeilenprogramms
	\begin{enumerate}
		\item Der Algorithmus muss über die Kommmandozeile ausführbar sein.
		\item Die erste Liste wird immer als Dateiname übergeben.
		\item Die zweite Liste kann entweder als Dateiname oder über STDIN übergeben werden.
		\item die GNU Standards für Kommandozeilenprogramme müssen eingehalten werden.
		\item Die POSIX Utility Guidelines müssen eingehalten werden.
		\item Das Programm muss unter openSuSE 13.1 laufen.
		\item Alle für das Programm erforderliche Abhängigkeiten
		(z.B. Pakete, Bibliotheken) müssen für openSuSE 13.1 verfügbar sein.
		\item Das Programm muss auf einem einzigen Kern lauffähig sein, aber
		darf das Laufen auf mehreren Kernen in einem Shared-Memory-Environment
		unterstützen.
		\item Die Systemvoraussetzungen des Programms dürfen ein Minimum von 32GB Arbeitsspeicher
              und ein Minimum von 200 GB Festplattenspeicher voraussetzen.
              Zwischenprozessliche Kommunikationswege dürfen nicht vorausgesetzt werden.
		\item Das Programm gibt Fehler und Debug Daten über STDERR aus.
		\item Errechnete Ergebnisse werden über STDOUT ausgegeben.
		\item Die Zielplatform ist Intel x86-64 (intel64).
	\end{enumerate}
	\item Spezifikationen der Qualitätssicherung
	\begin{enumerate}
		\item Der Algorithmus muss überprüfbar sein.
		\item Unittests sind verfügbar gemacht worden.
	\end{enumerate}
	\item Spezifikationen der Dokumentation
	\begin{enumerate}
		\item Sämtliche Funktionen müssen über einen Dokoumentationsblock dokumentiert werden
		\item Die Doc Strings der Funktionen müssen auf Englisch geschrieben werden.
	\end{enumerate}
\end{enumerate}


\subsection{Pflichtenheft}
\label{auszug:pflichtenheft}
\begin{itemize}

    \item Das Programm nimmt die Daten zum einen als Dateipfad oder Input über STDIN an.

    \item Die Ausführung des Programms mit dem Parameter \texttt{-h} bzw. \texttt{---help} ruft einen Hilfetext zur Nutzung des Programms auf.

    \item Die Ausführung des Programms mit dem Parameter \texttt{-v} bzw. \texttt{---version} ruft die derzeitige Versionsnummer des Programms auf.

    \item Das Programm wird auf und für openSuSE 13.1 entwickelt und kompiliert.

    \item Das Programm wird keine Form von Multithreading bzw Multiprocessing verwenden.

    \item Die zuerst über einen Dateipfad angegebene Liste wird in den Speicher gelesen;
    die zweite kann entweder als Dateipfad oder über STDIN eingegeben werden und wird Zeile für Zeile geladen.

    \item Das Programm garantiert einen konstanten Speicherverbrauch, welcher abhängig von der ersten Datei ist.

    \item Das Programm wird keine Eingabeüberprüfung vollziehen - Dateigröße und Format müssen vom Nutzer erkannt und angepasst werden.

    \item POSIX und GNU Guidelines werden für die Parameternamen der Kommandozeile eingehalten und angewendet.

    \item Für jede Routine, welche für das Programm geschrieben wird, wird es einen Test geben, der deren Funktion überprüft.

    \item Das Programm vergleicht Strings mit Hilfe einer Rekodierung von 7-Bit auf 5-Bit ASCII, gibt die Strings aber so aus wie sie eingegeben worden sind.

    \item Alle Funktionen werden über Dokumentationsblöcke dokumentiert; dies beinhaltet Datentypen der Parameter und Funktionsweise der Routine.

\end{itemize}
\clearpage




\section{Codeauszüge}
\label{sec:codeAuszüge}

\lstinputlisting[language=C, basicstyle=\tiny, caption=Beispiel eines Docstrings für Entwickler, label=listing:entwicklerDoku]{anhang/docstring.c}

\begin{lstlisting}[style=xterm, caption=Ausgabe der Endnutzerdokumentation über den --help parameter, label=fig:cliHelp,]

	nils@chantico:~/git/ematch/src> ./qgjoin --help
	Usage: qgjoin [OPTION] LEFT_LIST RIGHT_LIST
	   or: cat RIGHT_LIST | qgjoin LEFT_LIST
	Compare two lists of strings using a Q-gram-based Fuzzy Join algorithm.
	LEFT_LIST is expected to be a path to a file. It is read entirely into memory;
	it is your job to make sure it fits. The RIGHT_LIST argument can either be a file
	path, or input piped via STDIN.
	
	LEFT_LIST               List of strings to be kept in memory.
				Type: FILE PATH
	RIGHT_LIST              List of strings to compare LEFT_LIST against.
				Type: FILE PATH or STDIN
	
	--help, -h              Display this help output
	--version, -v           Display the version of the program.
	nils@chantico:~/git/ematch/src>

\end{lstlisting}

\begin{algorithm}
  \caption{Pseudocode}
  \label{listing:pseudocode}
  \begin{algorithmic}[1]
    \Procedure{qgjoin}{}
    \State $S_1, S_2 \gets \text{vectors of strings}$
    \State $S_1 \times S_2 \puts \text{vector of tuples of matches}$

    \Label \emph{Setup:}
    \If {$\left\vert S_1 \right\vert < \left\vert S_2 \right\vert$}
    \State $S \gets S_1$
    \State $T \gets S_2$
    \Else
    \State $S \gets S2$
    \State $T \gets S1$
    \EndIf

    \ForAll {$s\in S$}
    \State $i \gets \Call{intern}{s}$
    \State $Q \gets \Call{5grams}{s}$
      \ForAll {$q\in Q$}
      \State $R_q \gets R_q \cup i$
      \EndFor
    \EndFor

    \Label \emph{Run:}
    \ForAll {$t\in T$}
    \State $Q \gets \Call{5grams}{t}$
    \State $W \gets 1$, $I_r \gets 0$
    \ForAll {$q\in Q$}
      \ForAll {$r\in R_q$}
      \State $I_r \gets I_r + W$
      \EndFor
    \State $W \gets 2W$
    \EndFor

    \State $J_i \gets 0$, $max \gets 0$, $M \gets \emptyset$
    \ForAll {$s\in S$}
    \State $i \gets \Call{intern}{s}$
    \State $J_i \gets \Call{longest\_streak}{I_i}$
    \If {$J_i > max$}
    \State $max \gets J_i$
    \State $M \gets \{s\}$
    \ElsIf {$J_i = max$}
    \State $M \gets M \cup s$
    \EndIf
    \EndFor

    \If {$max$ good enough} \Comment{criterion can use the full state}
    \ForAll {$s\in M$}
    \State $\Call{output}{s, t}$
    \EndFor
    \EndIf
    \EndFor
    \EndProcedure
  \end{algorithmic}
\end{algorithm}


